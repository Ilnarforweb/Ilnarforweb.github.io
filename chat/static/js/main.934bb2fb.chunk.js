(window.webpackJsonpchat=window.webpackJsonpchat||[]).push([[0],[,,,,,,,,,function(e,t,n){e.exports=n(21)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(8),o=n.n(i),c=(n(14),n(1)),l=n(2),r=n(4),u=n(3),h=n(6),m=n(5),g=(n(15),function(e){function t(){return Object(c.a)(this,t),Object(r.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement("header",null,s.a.createElement("h1",null,"Chat for everyone"))}}]),t}(s.a.Component)),d=(n(16),function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(r.a)(this,Object(u.a)(t).call(this))).state={nickname:"",isAutorised:!1},e.buttonLabel="Login",e.handleChange=e.handleChange.bind(Object(h.a)(e)),e.handleLogin=e.handleLogin.bind(Object(h.a)(e)),e}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){this.setState({nickname:e.target.value})}},{key:"handleLogin",value:function(e){e.preventDefault(),this.state.isAutorised?(localStorage.setItem("nickname",this.state.nickname),this.chatLogout()):(localStorage.setItem("nickname",this.state.nickname),this.chatLogin())}},{key:"chatLogin",value:function(){this.setState({nickname:"",isAutorised:!0}),this.buttonLabel="Logout",this.input.classList.add("input-hidden")}},{key:"chatLogout",value:function(){this.setState({isAutorised:!1}),this.buttonLabel="Login",this.input.classList.remove("input-hidden")}},{key:"componentDidMount",value:function(){this.input=document.querySelector(".nick-input"),localStorage.nickname?this.chatLogin():this.chatLogout()}},{key:"render",value:function(){return s.a.createElement("div",{className:"login"},s.a.createElement("div",{className:"nickname"},s.a.createElement("span",null,"Your nickname:")," ",localStorage.nickname),s.a.createElement("form",null,s.a.createElement("input",{className:"nick-input",type:"text",placeholder:"Enter your nickname",value:this.state.nickname,onChange:this.handleChange}),s.a.createElement("button",{onClick:this.handleLogin},this.buttonLabel)))}}]),t}(s.a.Component)),k=(n(17),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(u.a)(t).call(this,e))).state={isConnected:!1},n.buttonLabel="Chat",n.handleConnect=n.handleConnect.bind(Object(h.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleConnect",value:function(e){var t=this;e.preventDefault(),this.state.isConnected?(this.props.socket.close(),this.props.socket.onclose=function(){return t.setState({isConnected:!1})},this.buttonLabel="Chat"):(this.props.openSocket(),setTimeout(function(){t.props.socket.onopen=function(){return t.setState({isConnected:!0})},t.buttonLabel="Exit"},0))}},{key:"openSocketState",value:function(){var e=this;this.props.socket&&this.state.isConnected&&(this.props.socket.onclose=function(t){e.props.openSocket()})}},{key:"render",value:function(){return this.openSocketState(),s.a.createElement("aside",{className:"connect"},s.a.createElement(d,null),s.a.createElement("button",{className:"chat-button",onClick:this.handleConnect},this.buttonLabel))}}]),t}(s.a.Component)),p=(n(18),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(u.a)(t).call(this,e))).state={messages:[]},n.unionMessages=[],n.visibility=!0,n.firstMessagesFlag=!0,n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"receiveMessages",value:function(){var e=this;this.props.socket&&(this.props.socket.onmessage=function(t){e.incomingMessages=JSON.parse(t.data),e.firstMessagesFlag||(e.uniqueId=e.incomingMessages.some(function(t){return t.id===e.unionMessages[0].id}),e.newMessages=e.incomingMessages.length-e.unionMessages.length,1===Math.sign(e.newMessages)&&(e.incomingMessages=e.incomingMessages.slice(0,e.newMessages),e.newMessagesFlag=!0)),(e.firstMessagesFlag||!e.uniqueId||e.newMessagesFlag)&&(e.newMessagesFlag=!1,e.firstMessagesFlag=!1,e.unionMessages=e.incomingMessages.concat(e.unionMessages),e.cuttedMessages=e.unionMessages.slice(0,100),e.cuttedMessages.reverse(),e.setState({messages:e.cuttedMessages}),e.chatNotification())})}},{key:"chatNotification",value:function(){Notification.requestPermission(),this.options={body:this.state.messages[this.state.messages.length-1].from+": "+this.state.messages[this.state.messages.length-1].message},!document.hidden&&this.visibility||(this.notification=new Notification("New message",this.options))}},{key:"windowVisibility",value:function(){var e=this;window.onblur=function(){return e.visibility=!1},window.onfocus=function(){return e.visibility=!0}}},{key:"messageDate",value:function(e){return this.unFormatedTime=new Date(e),this.unFormatedTime.toLocaleTimeString()}},{key:"scrollingBottom",value:function(){this.block=document.querySelector(".mlist"),this.block.scrollTop=this.block.scrollHeight}},{key:"componentDidUpdate",value:function(){this.scrollingBottom()}},{key:"render",value:function(){var e=this;return this.windowVisibility(),this.receiveMessages(),s.a.createElement("main",{className:"mlist"},s.a.createElement("ul",{className:"message-list"},this.state.messages.map(function(t){return s.a.createElement("li",{key:t.id,className:"message-list-item"},s.a.createElement("div",{className:"list-item-top"},s.a.createElement("div",{className:"from"},t.from),s.a.createElement("div",{className:"time"},e.messageDate(t.time))),s.a.createElement("div",{className:"message"},t.message))})))}}]),t}(s.a.Component)),b=(n(19),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(u.a)(t).call(this,e))).state={message:""},n.handleChange=n.handleChange.bind(Object(h.a)(n)),n.handleSend=n.handleSend.bind(Object(h.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){this.setState({message:e.target.value})}},{key:"handleSend",value:function(e){e.preventDefault(),this.props.socket&&this.props.socket.send(JSON.stringify({from:localStorage.nickname,message:this.state.message})),this.setState({message:""})}},{key:"render",value:function(){return s.a.createElement("footer",{className:"send-messages"},s.a.createElement("form",null,s.a.createElement("input",{type:"text",placeholder:"Enter your message",value:this.state.message,onChange:this.handleChange}),s.a.createElement("button",{onClick:this.handleSend},"Send")))}}]),t}(s.a.Component)),f=(n(20),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(u.a)(t).call(this,e))).state={socket:void 0},n.openSocket=n.openSocket.bind(Object(h.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"openSocket",value:function(){this.setState({socket:new WebSocket("wss://wssproxy.herokuapp.com/")})}},{key:"render",value:function(){return s.a.createElement("div",{className:"app"},s.a.createElement(g,null),s.a.createElement(p,{socket:this.state.socket}),s.a.createElement(k,{socket:this.state.socket,openSocket:this.openSocket}),s.a.createElement(b,{socket:this.state.socket}))}}]),t}(s.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(f,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[9,1,2]]]);
//# sourceMappingURL=main.934bb2fb.chunk.js.map